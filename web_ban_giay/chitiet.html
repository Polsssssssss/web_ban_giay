<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Chi ti·∫øt gi√†y - Toko</title>
    <link rel="stylesheet" href="css/kieu_dang.css">
</head>
<body>
    <!-- üîπ HEADER -->
    <header class="tieu_de">
        <div class="tieu_de_noi_dung">
            <a class="logo_chu" href="index.html" title="V·ªÅ trang ch·ªß">
                <img src="assets/logo/toko.svg" alt="Toko">
                <div class="ten_web">Toko</div>
            </a>
            <div class="khung_tim">
                <input id="o_tim_kiem" class="o_tim" placeholder="T√¨m gi√†y, h√£ng‚Ä¶">
                <button id="nut_tim_kiem" class="nut_tim">T√¨m</button>
            </div>
            <div class="khu_tai_khoan">
                <div id="hien_thi_tai_khoan"></div>
                <a class="nut_dang_nhap" id="nut_dang_nhap" href="dangnhap.html">ƒêƒÉng nh·∫≠p</a>
                <button class="nut_dang_xuat" id="nut_dang_xuat" style="display:none">ƒêƒÉng xu·∫•t</button>
                <a class="icon_gio_hang" href="giohang.html" title="Gi·ªè h√†ng">
                    üõí <span class="so_luong" id="so_gio_hang">0</span>
                </a>
            </div>
        </div>
    </header>

    <!-- üîπ N·ªòI DUNG CHI TI·∫æT -->
    <main class="khung_trang">
        <section class="khu_san_pham" style="grid-column:1 / -1">
            <div id="noi_dung_chi_tiet">ƒêang t·∫£i...</div>
        </section>
    </main>

    <!-- üîπ SCRIPT -->
    <script src="js/du_lieu.js"></script>
    <script src="js/xac_thuc.js"></script>
    <script src="js/gio_hang.js"></script>
    <script>
        // Kh·ªüi t·∫°o v√† hi·ªÉn th·ªã tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
        khoi_tao_du_lieu_co_ban();
        tai_hien_trang_thai_dang_nhap_header();

        // üî∏ Ch·∫∑n truy c·∫≠p gi·ªè h√†ng n·∫øu ch∆∞a ƒëƒÉng nh·∫≠p
        document.addEventListener('DOMContentLoaded', () => {
            const nut_gio = document.querySelector('.icon_gio_hang');
            if (nut_gio) {
                nut_gio.addEventListener('click', (e) => {
                    const tk = JSON.parse(localStorage.getItem('tai_khoan_dang_nhap') || 'null');
                    if (!tk) {
                        e.preventDefault();
                        alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem gi·ªè h√†ng!');
                        window.location.href = 'dangnhap.html';
                    }
                });
            }
        });

        // üîπ Hi·ªÉn th·ªã chi ti·∫øt s·∫£n ph·∫©m
        (async () => {
            const params = new URLSearchParams(location.search);
            const id = params.get('id') || localStorage.getItem('giay_dang_xem');
            const ds = JSON.parse(localStorage.getItem('du_lieu_giay') || '[]');
            const sp = ds.find(x => x.id === id);
            const div = document.getElementById('noi_dung_chi_tiet');

            if (!sp) {
                div.textContent = 'Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m.';
                return;
            }

            div.innerHTML = `
            <div style="display:grid; grid-template-columns:320px 1fr; gap:24px; align-items:start;">
              <img src="${sp.anh}" alt="${sp.ten}" style="width:100%; border:1px solid #222; border-radius:12px;">
              <div>
                <h2 style="margin-bottom:8px">${sp.ten}</h2>
                <div style="margin:6px 0">H√£ng: <strong>${sp.hang}</strong></div>
                <div class="gia_tien" style="font-size:20px; margin:8px 0;">
                  ${Number(sp.gia_tien).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}
                </div>
                <p style="margin-top:10px; color:#bbb;">${sp.mo_ta || ''}</p>

                <div style="margin-top:16px;">
                  <label style="font-weight:600;">Ch·ªçn size:</label>
                  <div id="chon_size" style="display:flex; gap:8px; margin-top:6px; flex-wrap:wrap;"></div>
                </div>

                <button id="nut_them_gio" class="nut_chinh" style="margin-top:16px;">üõí Th√™m v√†o gi·ªè h√†ng</button>
              </div>
            </div>
          `;

            // üîπ Sinh n√∫t ch·ªçn size
            const div_size = document.getElementById('chon_size');
            let size_da_chon = null;
            for (let size = 38; size <= 44; size++) {
                const nut = document.createElement('button');
                nut.textContent = size;
                nut.className = 'nut_size';
                nut.style = `
              padding:8px 12px;
              border:1px solid #555;
              border-radius:6px;
              background:#222;
              color:#fff;
              cursor:pointer;
            `;
                nut.onclick = () => {
                    document.querySelectorAll('.nut_size').forEach(n => n.style.background = '#222');
                    nut.style.background = '#E30613';
                    size_da_chon = size;
                };
                div_size.appendChild(nut);
            }

            // üîπ Th√™m v√†o gi·ªè h√†ng (ph·∫£i ch·ªçn size v√† ƒëƒÉng nh·∫≠p)
            document.getElementById('nut_them_gio').onclick = () => {
                const tk = JSON.parse(localStorage.getItem('tai_khoan_dang_nhap') || 'null');
                if (!tk) {
                    alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m s·∫£n ph·∫©m v√†o gi·ªè!');
                    window.location.href = 'dangnhap.html';
                    return;
                }
                if (!size_da_chon) {
                    alert('Vui l√≤ng ch·ªçn size tr∆∞·ªõc khi th√™m v√†o gi·ªè!');
                    return;
                }
                them_vao_gio(sp.id, size_da_chon);
            };
        })();
    </script>
</body>
</html>
